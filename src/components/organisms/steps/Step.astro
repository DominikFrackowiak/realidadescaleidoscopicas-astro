---
import { twMerge } from 'tailwind-merge'
import stagesData from '../../../../lib/constants/stageData'
import AudioPlayer from '../../molecules/audio-player/AudioPlayer.astro'
import Transcript from './Transcript.astro'

const wrapper = 'flex flex-col mx-auto w-full px-4 md:px-0 md:max-w-[720px] lg:max-w-[1140px] gap-[40px]'
---

{
  stagesData.map((stage, stageIndex) => (
    <section 
      id={`stage-${stage.category}`} 
      data-category={stage.category}
      class={twMerge(stage.backgroundColor, 'flex justify-center items-center py-20 min-h-[100vh] w-full main-section')}
    >
      <div class={twMerge(wrapper, 'step')}>
        <div class='flex gap-[10px] items-center h-[60px]'>
          <img src={stage.icon} class="w-[35px] h-[35px] md:w-[50px] md:h-[50px]"/>
          <h2 class={twMerge(stage.titleColor,"text-2xl md:text-4xl font-tavares md:mt-[9px] font-bold")}>{stage.title}</h2>
        </div>
        <p class={twMerge(stage.descriptionColor, "text-xl")}>{stage.description}</p>
        <button class={twMerge(stage.buttonBgColor, stage.buttonBgColorOnHover, "py-2 w-[80%] md:w-full md:w-2/5 relative mx-auto")}>
          <a href='/#participa' class={twMerge("font-tavares lg:text-xl text-white block text-center")}>
            Participa en Yincana
          </a>
        </button>
        <div class='flex flex-col gap-[40px] md:flex-row justify-around w-full'>
          {stage.audios.map((audio, audioIndex) => (
            <div class="audio-container w-full">
              <AudioPlayer
                audio={audio}
                iconPause={stage.iconPause}
                iconPlay={stage.iconPlay}
                hrColor={stage.borderColor}
                textColor={stage.audioTextColor}
                stageIndex={stageIndex}
                audioIndex={audioIndex}
              />
            </div>
          ))}
        </div>
      </div>
    </section>

    <section 
      id={`transcript-section-${stageIndex}`}
      class={twMerge(
        stage.transcriptBgColor, 
        'flex flex-col justify-center items-center py-20 min-h-[100vh] w-full transcript-section'
      )}
      style="display: none;"
    >
      {stage.audios.map((audio, audioIndex) => (
        <div 
          id={`transcript-${stageIndex}-${audioIndex}`}
          class={twMerge(
            wrapper,
            "audio-transcript relative w-full flex flex-col items-center gap-[40px]"
          )}
          data-stage={stageIndex}
          data-audio={audioIndex}
          style="display: none;"
        >
          <Transcript audio={audio} stageIndex={stageIndex} audioIndex={audioIndex}/>
        </div>
      ))}
    </section>
  ))
}

<script>
  import handleAudiosAndTranscripts from '../../../scripts/audiosTranscripts'
  handleAudiosAndTranscripts()
</script>